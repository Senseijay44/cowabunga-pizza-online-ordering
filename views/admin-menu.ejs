<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title><%= title %> | Cowabunga Pizza</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <header class="site-header">
    <nav class="nav">
      <a href="/" class="brand">Cowabunga Pizza</a>
      <ul class="nav-links">
        <li><a href="/menu">Menu</a></li>
        <li><a href="/cart">Cart</a></li>
        <li><a href="/checkout">Checkout</a></li>
        <li><a href="/admin/orders">Admin Orders</a></li>
        <li><a href="/admin/menu" class="active">Admin Menu</a></li>
      </ul>
    </nav>
  </header>

  <main class="content">
    <section class="page-header">
      <h1>Admin · Menu</h1>
      <p>Manage the menu configuration used by the builder and preset pizzas.</p>
    </section>

    <% if (message) { %>
      <div class="alert alert-success"><%= message %></div>
    <% } %>
    <% if (error) { %>
      <div class="alert alert-error"><%= error %></div>
    <% } %>

    <section class="admin-panel">
      <h2>Preset Pizzas</h2>
      <form class="admin-inline-form" action="/admin/menu/preset" method="POST">
        <input type="hidden" name="id" value="<%= editing && editing.section === 'preset' ? editing.item.id : '' %>">
        <div class="form-row">
          <label>
            Name
            <input type="text" name="name" required value="<%= editing && editing.section === 'preset' ? editing.item.name : '' %>" placeholder="Cowabunga Classic">
          </label>
          <label>
            Description
            <input type="text" name="description" value="<%= editing && editing.section === 'preset' ? editing.item.description : '' %>" placeholder="Pepperoni, mozzarella...">
          </label>
          <label>
            Price
            <input type="number" name="price" min="0" step="0.01" required value="<%= editing && editing.section === 'preset' ? editing.item.price : '' %>" placeholder="14.99">
          </label>
          <label class="checkbox">
            <input
              type="checkbox"
              name="isAvailable"
              <%= !editing || editing.section !== 'preset' || editing.item.isAvailable !== false ? 'checked' : '' %>
            > Available
          </label>
          <div class="form-actions">
            <button type="submit" class="cb-btn cb-btn--primary"><%= editing && editing.section === 'preset' ? 'Update Pizza' : 'Save Pizza' %></button>
            <% if (editing && editing.section === 'preset') { %>
              <a class="cb-btn cb-btn--outline" href="/admin/menu">Cancel</a>
            <% } %>
          </div>
        </div>
      </form>

      <div class="admin-table-wrapper">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Description</th>
              <th>Price</th>
              <th>Available</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% if (!presetPizzas || !presetPizzas.length) { %>
              <tr><td colspan="5">No preset pizzas yet.</td></tr>
            <% } else { %>
              <% presetPizzas.forEach((item) => { %>
                <tr>
                  <td><strong><%= item.name %></strong></td>
                  <td><%= item.description %></td>
                  <td>$<%= Number(item.price).toFixed(2) %></td>
                  <td><%= item.isAvailable !== false ? 'Yes' : 'No' %></td>
                  <td class="admin-actions">
                    <a class="cb-btn cb-btn--sm cb-btn--outline" href="/admin/menu?editSection=preset&editId=<%= item.id %>">Edit</a>
                    <form action="/admin/menu/preset/<%= item.id %>/delete" method="POST" class="inline-form" onsubmit="return confirm('Delete this preset pizza?');">
                      <button type="submit" class="cb-btn cb-btn--sm cb-btn--danger">Delete</button>
                    </form>
                  </td>
                </tr>
              <% }); %>
            <% } %>
          </tbody>
        </table>
      </div>
    </section>

    <% const configSections = [
      { key: 'sizes', title: 'Sizes', priceLabel: 'Price Modifier', placeholder: '1.0', action: 'Size' },
      { key: 'bases', title: 'Bases / Crusts', priceLabel: 'Base Price', placeholder: '8.00', action: 'Base' },
      { key: 'sauces', title: 'Sauces', priceLabel: 'Price', placeholder: '0.75', action: 'Sauce' },
      { key: 'cheeses', title: 'Cheeses', priceLabel: 'Price', placeholder: '0.00', action: 'Cheese' },
      { key: 'toppings', title: 'Toppings', priceLabel: 'Price', placeholder: '1.25', action: 'Topping' },
    ]; %>

    <% configSections.forEach((section) => { const items = menuConfig[section.key] || []; %>
      <section class="admin-panel">
        <h2><%= section.title %></h2>
        <form class="admin-inline-form" action="/admin/menu/<%= section.key %>" method="POST">
          <input type="hidden" name="id" value="<%= editing && editing.section === section.key ? editing.item.id : '' %>">
          <div class="form-row">
            <label>
              Name
              <input type="text" name="name" required value="<%= editing && editing.section === section.key ? editing.item.name : '' %>" placeholder="Name">
            </label>
            <label>
              <%= section.priceLabel %>
              <input type="number" name="price" step="0.01" value="<%= editing && editing.section === section.key ? (editing.item.priceModifier ?? editing.item.basePrice ?? editing.item.price ?? '') : '' %>" placeholder="<%= section.placeholder %>">
            </label>
            <label class="checkbox">
              <input type="checkbox" name="isAvailable" <%= !editing || editing.section !== section.key || editing.item.isAvailable !== false ? 'checked' : '' %>> Available
            </label>
            <div class="form-actions">
              <button type="submit" class="cb-btn cb-btn--primary"><%= editing && editing.section === section.key ? 'Update' : 'Save' %> <%= section.action %></button>
              <% if (editing && editing.section === section.key) { %>
                <a class="cb-btn cb-btn--outline" href="/admin/menu">Cancel</a>
              <% } %>
            </div>
          </div>
        </form>

        <div class="admin-table-wrapper">
          <table class="admin-table">
            <thead>
              <tr>
                <th>Name</th>
                <th><%= section.priceLabel %></th>
                <th>Available</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% if (!items.length) { %>
                <tr><td colspan="4">No items configured.</td></tr>
              <% } else { %>
                <% items.forEach((item) => { %>
                  <% const priceVal = item.priceModifier ?? item.basePrice ?? item.price; %>
                  <tr>
                    <td><strong><%= item.name %></strong></td>
                    <td><%= priceVal !== undefined ? priceVal : '—' %></td>
                    <td><%= item.isAvailable !== false ? 'Yes' : 'No' %></td>
                    <td class="admin-actions">
                      <a class="cb-btn cb-btn--sm cb-btn--outline" href="/admin/menu?editSection=<%= section.key %>&editId=<%= item.id %>">Edit</a>
                      <form action="/admin/menu/<%= section.key %>/<%= item.id %>/delete" method="POST" class="inline-form" onsubmit="return confirm('Delete this item?');">
                        <button type="submit" class="cb-btn cb-btn--sm cb-btn--danger">Delete</button>
                      </form>
                    </td>
                  </tr>
                <% }); %>
              <% } %>
            </tbody>
          </table>
        </div>
      </section>
    <% }); %>
  </main>

  <footer class="site-footer">
    <p>&copy; 2025 Cowabunga Pizza. Powered by pizza.</p>
  </footer>
</body>
</html>
